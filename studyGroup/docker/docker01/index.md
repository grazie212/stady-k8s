# Dockerの概要

## 対象

---

|   |   |
|---|---|
|目的 |dockerとはどういうものなのか理解する |
|対象 |dockerを触ったことのない人 |

## 目次

---

1. コンテナの概要
   1. [コンテナとは](#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%A8%E3%81%AF)
   2. [サーバ仮想化との違い](#%E3%82%B5%E3%83%BC%E3%83%90%E4%BB%AE%E6%83%B3%E5%8C%96%E3%81%A8%E3%81%AE%E9%81%95%E3%81%84)
2. 開発におけるDocker
   1. [開発環境と実行環境](#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%81%A8%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83)
3. Dockerの機能
   1. [Dockerの機能-Build](#docker%E3%81%AE%E6%A9%9F%E8%83%BD-build)
   2. [Dockerの機能-Ship](#docker%E3%81%AE%E6%A9%9F%E8%83%BD-ship)
   3. [Dockerの機能-Run](#docker%E3%81%AE%E6%A9%9F%E8%83%BD-run)
4. Dockerコンテナの仕組み
   1. [区画化の仕組み](#%E5%8C%BA%E7%94%BB%E5%8C%96%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF)
   2. [リソース管理](#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E7%AE%A1%E7%90%86)
   3. [ネットワークの管理](#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E7%AE%A1%E7%90%86)
5. 終わりに
   1. [あとがき](#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D)

## コンテナの概要

---

### コンテナとは

コンテナの目的とは、アプリケーションの実行環境をまとめることで、可搬性を高めることでスケーラブルな環境でも動作するようにすることです。すなわち、いつでもどこでも同様に実行できるということです。

実装としては、ホストOS上に論理的な区画（コンテナ）を作り、アプリケーションを動作させるのに必要なライブラリ等を一つにまとめたもの。コンテナはリソースなどを論理的に分離させて実行することができます。

![コンテナの構成](https://raw.githubusercontent.com/grazie212/stady-k8s/master/studyGroup/img/docker01_01.jpg)

### サーバ仮想化との違い

よく比較されるところのまとめです。目的が違うので比較するのもどうかとは思いますが、、、

|   |サーバ仮想化|コンテナ|
|---|---|---|
|起動方法|通常のOSと同等|MBR等の読み込みなしに起動|
|リソース|HWをエミュレート|Namespaceとcgroupsなどの仕組みを利用|
|目的|インフラを仮想化する|アプリケーションの可搬性を高める|
|メリット|分離レベルが高い|オーバーヘッドが少ない|

## 開発におけるDocker

---

### 開発環境と実行環境

Dockerを利用した開発では、開発したアプリケーションに実行に必要なすべてが含まれるDockerイメージを作成するという特徴があります。これにより、開発環境では動いたけどテスト環境で動かない！！！なんてリスクを軽減することができます。

![開発環境](https://raw.githubusercontent.com/grazie212/stady-k8s/master/studyGroup/img/docker01_01.jpg)

アプリケーションの可搬性の話

一度作ってしまうと、何処でも動くソフトウェアの特性です。Dockerでは高い可搬性があるため、オンプレミスの環境やクラウド環境との親和性が高く移行が容易です。お客様目線で考えると、自前でリソースを保持することなく、コストパフォーマンスが良いベンダーのクラウドサービスを使うことができます。

## Dockerの機能

---

大きく三つの機能があります！

### Dockerの機能-Build

BuildとはDockerイメージを作る機能です。

Dockerでは、アプリケーションの実行に必要となるプログラム本体・ライブラリ・MW・OSやNW設定などをまとめたDockerイメージを作ることになると思います。DockerイメージはDockerfileをビルドして作成することができます。

下記ではcentos7の上にhttpdをインストールして起動するイメージを作成します

```Dockerfile
FROM centos

RUN yum -y update
RUN yum -y install httpd

EXPOSE 80
CMD ["/usr/sbin/httpd"]
```

下記のコマンドで実行できます

```bash
$ docker build -t [付けたいイメージ名] .
```

イメージができたかどうかは下記のコマンドで確認可能です。

```bash
$ docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
httpd_centos7       latest              f13d81466f0b        2 minutes ago       534MB
```

### Dockerの機能-Ship

ShipとはDockerイメージを共有する機能です。

個人で作成したイメージはDockerHubにアップロードすることができます。
また、GitHubやBitbucket等のリポジトリホスティングサービスと連携することで、自動ビルドしてくれるような機能も存在しています。

また、プライベートリポジトリなども存在しています。

### Dockerの機能-Run

RunとはDockerコンテナを動かす機能です。

下記のコマンドで実行できます

```bash
$ docker run [オプション名] [イメージ名]
```

## Dockerコンテナの仕組み

---

### 区画化の仕組み

|namespaceの種類|説明|
|---|---|
|PID namespace|PID（各プロセスに割り当てられたユニークなID）とプロセスを分離する|
|Network namespace|ネットワークリソースをnamespace毎に保持できる|
|UID namespace|UID（ユーザID）GID（グループID）をnamespace毎に保持できる|
|MOUNT namespace|namespace毎に隔離されたファイルシステムツリーが作成される|
|UTS namespace|namespace毎にホスト名やドメイン名を独自に持つことができる|
|IPC namespace|プロセス間通信オブジェクトをnamespace毎に独立して持つことができる|

### リソース管理

リソース管理はLinuxのカーネル機能である、cgroupsを利用して行われています。cgroupsはプロセスやスレッドをグループ化し、リソースをグループ毎に制限することができます。この機能により、重要なグループのリソースが枯渇するリスクを軽減することができます。

### ネットワークの管理

Dockerを利用する場合、サーバの物理NICがdocker0(仮想ブリッジ)に接続されます。
ネットワークを利用する際はNAPTの機能を利用して、コンテナにアクセスできます。

![ネットワークの考え方](https://raw.githubusercontent.com/grazie212/stady-k8s/master/studyGroup/img/docker01_03.jpg)

## 終わりに

---

### あとがき

コンテナ技術を主体とした考え方が広まってきており、基盤技術の大部分が抽象化されてきています。それにより、アプリケーションレイヤと基盤レイヤの境目が曖昧になってきている状況です。これから、クラウドサービスを利用するというお客さんも多く出てくると思いますが、そういう時にDockerやk8sなどの知識と構築経験があると強みになると思います。

これから複数回に分けて、Docker/k8s/OpenShiftの勉強会をしていきたいと思っています。
素人が適当に言っているだけですが、2025年に向けて自分たちが食べて行けるようにするために必要な知識だと思っているので、お時間許すのであればご参加をお願いします。

## 参考

- [プログラマのためのDocker教科書 第2版 インフラの基礎知識&コードによる環境構築の自動化](https://www.amazon.co.jp/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AEDocker%E6%95%99%E7%A7%91%E6%9B%B8-%E7%AC%AC2%E7%89%88-%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E3%81%AE%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98-%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E3%82%88%E3%82%8B%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89%E3%81%AE%E8%87%AA%E5%8B%95%E5%8C%96-WINGS%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88/dp/4798153222)
- [コンテナ技術の基礎知識](https://thinkit.co.jp/story/2015/08/11/6285)